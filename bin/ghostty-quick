#!/bin/bash
# ghostty-quick - Persistent terminal multiplexer session

SESSION="${GQ_SESSION:-dropdown}"
MUX="${GQ_MUX:-auto}"

# Auto-detect multiplexer
if [[ "$MUX" == "auto" ]]; then
    if command -v zellij &>/dev/null; then
        MUX="zellij"
    elif command -v tmux &>/dev/null; then
        MUX="tmux"
    else
        echo "No multiplexer found. Install zellij or tmux." >&2
        exit 1
    fi
fi

case "$MUX" in
    zellij)
        if zellij list-sessions 2>/dev/null | grep -q "$SESSION"; then
            exec zellij attach "$SESSION"
        else
            exec zellij --session "$SESSION"
        fi
        ;;
    tmux)
        if tmux has-session -t "$SESSION" 2>/dev/null; then
            exec tmux attach -t "$SESSION"
        else
            exec tmux new-session -s "$SESSION"
        fi
        ;;
    *)
        echo "Unknown multiplexer: $MUX" >&2
        exit 1
        ;;
esac
